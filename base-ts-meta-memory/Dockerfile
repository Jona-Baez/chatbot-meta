# Build stage
FROM node:21-alpine3.18 as builder

WORKDIR /app

# Copiar archivos de dependencias e instalar paquetes
COPY package*.json ./
RUN npm install

# Copiar todo el c贸digo fuente
COPY . .

# Compilar la aplicaci贸n
RUN npm run build

# Deployment stage
FROM node:21-alpine3.18 as deploy

WORKDIR /app

ARG PORT
ENV PORT $PORT
EXPOSE $PORT

# Copiar archivos necesarios desde el builder
COPY --from=builder /app/assets ./assets
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/package*.json ./

# Instalar solo dependencias de producci贸n
RUN npm install --omit=dev

# Iniciar la aplicaci贸n con npm
CMD ["npm", "start"]
